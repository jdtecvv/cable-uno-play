root@cableuno:/var/www/cable-uno-play# # 1. Copiar el script de diagnÃ³stico
cat > /tmp/diagnostico.sh << 'EOF'
#!/bin/bash

echo "=========================================="
echo "ğŸ” DIAGNÃ“STICO CABLE UNO PLAY"
echo "=========================================="
echo ""

echo "1ï¸âƒ£ Estado de PM2:"
pm2 list
echo ""

echo "2ï¸âƒ£ Logs recientes (Ãºltimas 30 lÃ­neas):"
pm2 logs cable-uno-play --lines 30 --nostream
echo ""

echo "3ï¸âƒ£ Estado del puerto 5000:"
netstat -tuln | grep 5000
echo ""

echo "4ï¸âƒ£ Variable DATABASE_URL configurada:"
pm2 env 0 | grep DATABASE_URL
echo ""

echo "5ï¸âƒ£ Test de conexiÃ³n HTTP local:"
curl -I http://localhost:5000 2>&1 | head -10
echo ""

echo "=========================================="
echo "âœ… DiagnÃ³stico completo"
echo "=========================================="
EOF

# 2. Ejecutar el diagnÃ³stico
bash /tmp/diagnostico.sh
==========================================
ğŸ” DIAGNÃ“STICO CABLE UNO PLAY
==========================================

1ï¸âƒ£ Estado de PM2:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name              â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ cable-uno-play    â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 33875    â”‚ 3m     â”‚ 7    â”‚ online    â”‚ 0%       â”‚ 83.5mb   â”‚ root     â”‚ disabled â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2ï¸âƒ£ Logs recientes (Ãºltimas 30 lÃ­neas):
[TAILING] Tailing last 30 lines for [cable-uno-play] process (change the value with --lines option)
/root/.pm2/logs/cable-uno-play-error.log last 30 lines:
0|cable-un |       at TLSSocket.onConnectSecure (node:_tls_wrap:1687:27)
0|cable-un |       at TLSSocket.emit (node:events:524:28)
0|cable-un |       at TLSSocket._finishInit (node:_tls_wrap:1076:8)
0|cable-un |       at ssl.onhandshakedone (node:_tls_wrap:862:12) {
0|cable-un |     code: 'ERR_TLS_CERT_ALTNAME_INVALID',
0|cable-un |     reason: "Host: localhost. is not in the cert's altnames: DNS:app.teleunotv.cr, DNS:play.teleunotv.cr",
0|cable-un |     host: 'localhost',
0|cable-un |     cert: {
0|cable-un |       subject: [Object: null prototype],
0|cable-un |       issuer: [Object: null prototype],
0|cable-un |       subjectaltname: 'DNS:app.teleunotv.cr, DNS:play.teleunotv.cr',
0|cable-un |       infoAccess: [Object: null prototype],
0|cable-un |       ca: false,
0|cable-un |       bits: 256,
0|cable-un |       pubkey: <Buffer 04 92 4f 1f 2f 83 89 71 cc 5b 33 0c ea 84 92 ce cb ed 0f ce 8b 0d 27 30 85 bb 9a 96 e3 1d d5 67 98 3b 87 3d 04 69 e4 1e 8c be 8b 6c d4 2b 82 10 b3 0c ... 15 more bytes>,
0|cable-un |       asn1Curve: 'prime256v1',
0|cable-un |       nistCurve: 'P-256',
0|cable-un |       valid_from: 'Nov 12 12:27:48 2025 GMT',
0|cable-un |       valid_to: 'Feb 10 12:27:47 2026 GMT',
0|cable-un |       fingerprint: 'A5:6C:1A:E0:66:FA:4C:95:CB:9F:50:9A:43:0D:4D:68:06:53:CE:6A',
0|cable-un |       fingerprint256: 'B0:B1:79:91:EE:B4:FD:0F:59:58:86:2C:4B:94:5D:93:56:A5:CB:24:55:6E:4F:D7:0B:4A:8D:D7:E4:E1:B4:B9',
0|cable-un |       fingerprint512: '9A:38:C9:A5:81:8A:CB:8C:06:F6:B1:67:CF:79:15:E5:F8:B4:5A:47:FF:DF:D0:D5:71:EB:04:CB:08:09:2B:DC:B0:6C:6F:77:FA:1E:1E:6D:F6:42:74:59:AB:9D:0D:E6:30:D1:8E:8C:B5:8A:C3:B4:CF:B0:5A:56:0D:B8:99:54',
0|cable-un |       ext_key_usage: [Array],
0|cable-un |       serialNumber: '067C27E83D9F625819769992E08BB386242B',
0|cable-un |       raw: <Buffer 30 82 03 a1 30 82 03 26 a0 03 02 01 02 02 12 06 7c 27 e8 3d 9f 62 58 19 76 99 92 e0 8b b3 86 24 2b 30 0a 06 08 2a 86 48 ce 3d 04 03 03 30 32 31 0b 30 ... 883 more bytes>,
0|cable-un |       issuerCertificate: [Object]
0|cable-un |     }
0|cable-un |   },
0|cable-un |   [Symbol(kMessage)]: "Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:app.teleunotv.cr, DNS:play.teleunotv.cr"
0|cable-un | }

/root/.pm2/logs/cable-uno-play-out.log last 30 lines:
0|cable-un | 7:29:07 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:29:17 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:29:17 AM [express] GET /api/proxy/stream 404 in 2ms
0|cable-un | 7:29:18 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:29:29 AM [express] GET /api/proxy/stream 404 in 4ms
0|cable-un | 7:29:29 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:29:37 AM [express] GET /api/proxy/stream 404 in 4ms
0|cable-un | 7:29:47 AM [express] GET /api/proxy/stream 404 in 5ms
0|cable-un | 7:29:47 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:29:49 AM [express] GET /api/proxy/stream 404 in 4ms
0|cable-un | 7:29:59 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:29:59 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:30:00 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:30:07 AM [express] GET /api/proxy/stream 404 in 4ms
0|cable-un | 7:30:07 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:30:17 AM [express] GET /api/proxy/stream 404 in 4ms
0|cable-un | 7:30:20 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:30:20 AM [express] GET /api/proxy/stream 404 in 2ms
0|cable-un | 7:30:21 AM [express] GET /api/proxy/stream 404 in 3ms
0|cable-un | 7:30:28 AM [express] GET /api/proxy/stream 404 in 4ms
0|cable-un | 7:30:28 AM [express] GET /api/proxy/stream 404 in 2ms
0|cable-un | 7:30:37 AM [express] GET /api/proxy/stream 404 in 4ms
0|cable-un | 7:36:56 AM [express] serving on port 5000
0|cable-un | 7:39:01 AM [express] serving on port 5000
0|cable-un | ğŸš€ Registering API routes with prefix: /api
0|cable-un | ğŸ“¡ Registering route: GET /api/proxy/stream
0|cable-un | 7:44:37 AM [express] serving on port 5000
0|cable-un | ğŸš€ Registering API routes with prefix: /api
0|cable-un | ğŸ“¡ Registering route: GET /api/proxy/stream
0|cable-un | 7:49:32 AM [express] serving on port 5000


3ï¸âƒ£ Estado del puerto 5000:
tcp        0      0 127.0.0.1:5000          0.0.0.0:*               ESCUCHAR   

4ï¸âƒ£ Variable DATABASE_URL configurada:
DATABASE_URL: postgresql://cableuno:I@sd1844R0y@localhost:5432/cableuno_play

5ï¸âƒ£ Test de conexiÃ³n HTTP local:
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0  2301    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
HTTP/1.1 200 OK
X-Powered-By: Express
Accept-Ranges: bytes
Cache-Control: public, max-age=0
Last-Modified: Fri, 14 Nov 2025 13:44:35 GMT
ETag: W/"8fd-19a829c58e9"
Content-Type: text/html; charset=UTF-8

==========================================
âœ… DiagnÃ³stico completo
==========================================
root@cableuno:/var/www/cable-uno-play# 